package rules.rules_2


import com.ftn.sbnz.model.examples_1.Customer
import com.ftn.sbnz.model.examples_1.Coupon;
import com.ftn.sbnz.model.examples_1.Order;
import java.util.Date
import com.ftn.sbnz.model.examples_1.Coupon
import com.ftn.sbnz.model.examples_1.enums.CouponType;

rule "Create Coupons for Silver Customers"
    when
        $o: Order( $customer: customer )
        $c: Customer(this == $customer, category == Category.SILVER )
    then
        System.out.println("Create Coupons for Silver Customers");
        Coupon $k = new Coupon($c, $o, CouponType.POINTS);
        $k.setValidUntil(new Date(20));
        insert($k);
end 

rule "Init current date"
	when
	then
        System.out.println("Init current date");
		insert(new Date());
end

rule "Expire coupons"
	when
		$now: Date()
		$cp: Coupon( validUntil < $now )
	then
        System.out.println("Expire coupons");
		delete($cp);
		System.out.println("Deleted: " + $cp);
end

rule "Execute coupon"
	when
		$o: Order()
		$cp: Coupon(order == $o)
	then
		System.out.println("We have a coupon for this order!");
end
